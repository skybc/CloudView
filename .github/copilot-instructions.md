# CloudView AI 代码助手指南

## 项目概述
CloudView 是一个基于 WPF 的三维点云可视化应用程序，采用 .NET 8 构建。使用 Silk.NET 通过 OpenGL 渲染大型点数据集，支持感兴趣区域（ROI）选择和摄像机操纵。

## 架构

### 两个项目结构
- **CloudView**（主应用）：WPF 应用程序，采用 MVVM 模式、UI 编排和数据绑定
- **CloudView.Controls**（可重用控件）：类库，包含 `PointCloudViewer` 自定义控件

### 关键组件

#### PointCloudViewer 控件（CloudView.Controls/PointCloudViewer.cs）
核心渲染引擎，职责复杂：
- **OpenGL 集成**：与原生 Win32 API 互操作（GetDC、wglCreateContext、wglMakeCurrent）以管理渲染上下文
- **着色器管理**：编译/链接 GLSL 顶点着色器和片段着色器（作为类中的常量字符串存储）
- **缓冲区管理**：为点数据维护 VAO/VBO，顶点布局为 3 个浮点数（位置）+ 4 个浮点数（RGBA 颜色）
- **摄像机系统**：实现具有旋转、缩放和注视点机制的视图/投影矩阵
- **鼠标交互**：处理 ROI 选择（左拖）、3D 旋转（右拖）和缩放（滚轮）
- **渲染循环**：60 FPS 调度程序计时器，调用 `Render()` 方法


## 外部依赖
- **Silk.NET**：低级 OpenGL 绑定；用于着色器编译、VAO/VBO 管理、矩阵统一变量
- **MVVM 工具包**：通过源生成器简化属性/命令生成
- **.NET System.Numerics**：Vector3/Vector4/Matrix4x4 类型（.NET 框架内置）

### 必须要阅读
- 必须阅读doc/readme.md
- 阅读doc/readme.md,根据readme.md的内容,然后按需阅读doc/modules/目录下的相关模块文档。

## 开发后的文档更新
- 在 `doc/modules/` 对应的文档中补充开发总结，一个模块对应一个文件，不要一个模块多个文件。
- 如有必要，更新导航文档（readme.md）
- readme.md 中的模块导航必须保持最新,内容简洁、准确，没有过多的冗余信息。
- 确保文档与代码保持同步

## 开发前的准备
- 必须要阅读现有的代码，然后分析
- 不明确功能必须向我确认，不可自行决定
- 功能没有问题，必须先制定方案和步骤

## 代码实现标准
- 必须严格按制定的方案和步骤实现
- 必须遵循代码质量标准和风格指南

## 代码质量标准
- 遵循 SOLID 原则
- 使用 XML 注释进行公共 API 文档
- 注意内存安全，不要内存泄露

### 风格指南
- 启用 C# 14 功能
- 启用可空引用类型
- 用于 I/O 操作的 async/await 模式
- LINQ 用于集合操作

### 架构原则
- 基于接口的设计以提高可测试性
- 用于共享状态的单例管理器
- 事件驱动通信模式
- 模块化项目组织

记住：这是一个需要高可靠性、精确测量和实时性能的生产工业系统。始终考虑线程安全性、错误处理和硬件集成约束。